# 协方差矩阵与矩阵分解

## 1 协方差矩阵定义
$$
X = [X_1, X_2, .., X_n]^T\\
\mu = [\mu_1, \mu_2, ..., \mu_n]^T\\
\Sigma = E[(X-\mu)(X-\mu)^T]
$$

## 2 协方差矩阵的半正定性质

1. 协方差矩阵为半正定矩阵

   证明：

   $$
   \forall \  a \in Vec_{n,1} \and a \not = 0
    \\ a^T\Sigma a = a^TE[(X-\mu)(X-\mu)^T]a
    \\ = E[a^T(X-\mu)(X-\mu)^Ta]
    \\ = E[((X-\mu)^Ta)^T(X-\mu)^Ta]
    \\ = E[||(X-\mu)^Ta||^2] \geq 0
   $$

## 3 相似对角化

1. 定义：设A为n阶对称矩阵，则必有正交矩阵U，使得
   $$
   A = U\Lambda U^T\\
   U^{-1}AU = \Lambda
   $$
   

   $\Lambda$是对角线上的元素从大到小排列的特征值的对角阵

2. 理论基础：实对称矩阵的特征值为实数，实对称矩阵一定有n个线性无关的特征向量。

3. 构造：
   $$
   如果有s个不同的特征值
   \\ S = (\mu_{11},...,\mu_{1k_1},\mu_{21}, ...,\mu_{2k_2},...,\mu_{s1}, ...,\mu_{sk_s})
   \\ \Lambda = (\lambda_1, ..., \lambda_1, \lambda_2,...,\lambda_2, \lambda_n,...,\lambda_n)
   $$

4. 证明：
   $$
   AS = (A\mu_{11},...,A\mu_{1k_1},A\mu_{21}, ...,A\mu_{2k_2},...,A\mu_{s1}, ...,A\mu_{sk_s}) 
   \\= (\lambda_1\mu_{11},...,\lambda_1\mu_{1k_1},\lambda_2\mu_{21}, ...,\lambda_2\mu_{2k_2},...,\lambda_s\mu_{s1}, ...,\lambda_s\mu_{sk_s})
   \\ =(\mu_{11},...,\mu_{1k_1},\mu_{21}, ...,\mu_{2k_2},...,\mu_{s1}, ...,\mu_{sk_s})diag(\lambda_1,...,\lambda_1,\lambda_2,...,\lambda_2,...,\lambda_s,...,\lambda_s)
   \\ \longrightarrow A S=S\Lambda
   \\ \longrightarrow A = S\Lambda S^{-1}
   \\ 根据施密特正交化，存在U使得S=UD，其中D为对角线全1的上三角矩阵,U为正交矩阵。
   \\ 所以UD\Lambda(UD)^{-1}=U(D\Lambda D^{-1})U^{-1}
   \\ =U([\lambda_1C_1, \lambda_1C_2,...,\lambda_sC_n]
   \left[
   \begin{matrix}
   L_1\\
   L_2\\
   ...\\
   L_n
   \end{matrix} 
   \right])U^{-1}
   \\=U(\lambda_1C_1L_1+\lambda_1C_2L_2+...+\lambda_sC_nL_n)U^{-1}
   \\=U\Lambda U^{-1}
   $$
   注意，经过施密特正交化的$U$，仍然是由特征向量拼起来的。但是他的特征向量与$S$不同，是通过特征子空间依次施密特正交化得来的。

5. 实际意义

* $\Sigma x$的意义：
  $$
  \Sigma x = U\Lambda U^Tx
  \\ = U\Lambda 
  \left[
  \begin{matrix}
  \mu_{1}^T\\
  \mu_{2}^T\\
  ...\\
  \mu_{n}^T
  \end{matrix}
  \right]
  [a_1\mu_1+a_2\mu_2+...+a_n\mu_n]
  \\=U\Lambda
  \left[
  \begin{matrix}
  a_1\\
  a_2\\
  ...\\
  a_n
  \end{matrix}
  \right]
  =U\left[
  \begin{matrix}
  \lambda_1a_1\\
  \lambda_1a_2\\
  ...\\
  \lambda_sa_n
  \end{matrix}
  \right]
  =(U^T)^{-1}\left[
  \begin{matrix}
  \lambda_1a_1\\
  \lambda_1a_2\\
  ...\\
  \lambda_sa_n
  \end{matrix}
  \right]
  $$
  可以理解为，x在特征向量方向商分别增加$\lambda$倍，也就是在U坐标下单位圆变成椭圆。

* $x^T\Sigma x$的意义
  $$
  x^T\Sigma x = (U^Tx)^T\Lambda U^Tx 
  \\ = [a_1, a_2,...,a_n]\Lambda \left[
  \begin{matrix}
  a_1\\
  a_2\\
  ...\\
  a_n
  \end{matrix}
  \right]
  \\ =\lambda_1a_1^2+\lambda_1a_2^2 + ... + \lambda_sa_n^2
  $$
  即为在特征向量正交基下的坐标二次方乘以特征值后求和

## 4 奇异值分解

1. 定义：相似对角化对矩阵有着较高的要求，它需要被分解的矩阵$A$为实对称矩阵，但是现实中，我们所遇到的问题一般不是实对称矩阵。那么当我们碰到一般性的矩阵，即有一个$m×n$的矩阵A，它是否能被分解成类似的形式。
   $$
   有一个n\times m的实矩阵A，可以分解为:\\
   A = U\Sigma V^T\\
   其中U和V是单位正交阵，U称为左奇异矩阵，V称为右奇异矩阵。
   \\Σ仅在主对角线上有值，我们称它为奇异值，其它元素均为0。
   $$

2. 证明：
   $$
   S=A^TA = U^T\Sigma U\\
   U^TSU = \Sigma
   \\U^TA^TAU=\Sigma
   \\(AU)(AU)^T=\Sigma\
   \\ AU 列正交，AU=VS，其中V是正交矩阵，S除了对角线元素其他都是0 
   \\ \longrightarrow A = VSU^T
   $$

3. 求解方法：
$$
AA^T=U\Sigma V^T V \Sigma^T U^T = U\Sigma \Sigma^T U^T
\\ A^TA = V\Sigma^TU^TU\Sigma V^T = V\Sigma^T\Sigma V^T
$$

​	由于$AA^T$和$A^TA$都是对称矩阵，此即相似对角化的结果，$U$为$AA^T$的特征向量为列向量的矩阵，$V$为$A^TA$的特征向量为列向量的矩阵，奇异值可以有$A^TA$或者$AA^T$的特征值(因为是正定矩阵，所以特征值非负)开方得到。

3. 意义：奇异值可以被看作成一个矩阵的代表值，或者说，奇异值能够代表这个矩阵的信息。当奇异值越大时，它代表的信息越多。因此，若前面若干个最大的奇异值，就可以基本上还原出数据本身。

4. 分析思想去理解奇异值：
   $$
   有n阶矩阵A，令y=Ax\\
   当x^Tx=1时，x表示了n维正球面上的点。\\
   y^TA^{-T}A^{-1}y = 1\\
   即y^TBy = 0。
   由于B正定，这表示一个椭球面, 且其完全由该椭球面的n个局部极值点确定。\\
   因为y^Ty = x^TA^TAx\\
   \rho_A(x) = \frac{y^Ty}{x^Tx} = \frac{x^TA^TAx}{x^Tx}\\
   tr(d\rho) = tr(\frac{d(x^TA^TAx)x^Tx-x^TA^TAxd(x^Tx)}{(x^Tx)^2})
   \\ = tr(\frac{(dx^TA^TAx+x^TA^TAdx)x^Tx-x^TA^TAx(dx^Tx+x^Tdx)}{(x^Tx)^2})
   \\ = tr(\frac{(A^TAx+A^TAx)}{x^Tx}^Tdx) - tr(\frac{xx^T(A^TAx+A^TAx)}{(x^Tx)^2}^Tdx)
   \\ = tr(\frac{4A^TAx}{x^Tx}^T dx)
   \\ \longrightarrow A^TAx=\frac{xx^TA^TAx}{x^Tx} = \frac{x^TA^TAx}{x^Tx} x
   \\ 可以得知，极值点方向为A^TA的特征向量，大小为A^TA特征值的平方根
   \\ 可以知道单位球面有n个向量(v_1, v_2, ..., v_n), 左乘A变成极值点(u_1,u_2,...,u_n)
   \\A[v_1,v_2,...,v_n]
   =[u_1,u_2,...,u_n]
   \left[
   \begin{matrix}
   \lambda_1 & ... & ... \\
   ... & ... & ... \\
   ... & ... & \lambda_n \\
   \end{matrix}
   \right]
   \\ 可以证明v是正交(难点)
   \\ A = U \Sigma V^T
   $$

   5. 代数思想理解奇异值：
      $$
      Ax = U\Sigma V^Tx
      \\ = U\Sigma
      \left[
      \begin{matrix}
      \mu_{1}^T\\
      \mu_{2}^T\\
      ...\\
      \mu_{n}^T
      \end{matrix}
      \right]
      [a_1\mu_1+a_2\mu_2+...+a_n\mu_n]
      \\=U\Sigma
      \left[
      \begin{matrix}
      a_1\\
      a_2\\
      ...\\
      a_n
      \end{matrix}
      \right]
      =U\left[
      \begin{matrix}
      \sigma_1a_1\\
      \sigma_1a_2\\
      ...\\
      \sigma_sa_n
      \end{matrix}
      \right]
      =[\alpha_1,\alpha_2,...,\alpha_n]\left[
      \begin{matrix}
      \sigma_1a_1\\
      \sigma_2a_2\\
      ...\\
      \sigma_na_n
      \end{matrix}
      \right]
      = \sigma_1a_1\alpha_1 + .. + \sigma_sa_n\alpha_n
      $$
      可以看V正交系下的单位圆变换到新的正交系下的椭圆。

## 5 协方差矩阵的特征向量和特征值

1. 特征向量和特征值的含义

$$
设Y = AX， 其中A是通过伸缩和正交变换得到的，X是不相关的
\\ A = U\Lambda^{\frac{1}{2}}
\\ \Sigma_X = E[(X-\mu_X)(X-\mu_X)^T] =D,D为对角阵
\\ \Sigma_Y= E[(Y-\mu_Y)(Y-\mu_Y)^T]
\\ = E[(AX-A\mu_X)(AX-A\mu_X)^T]
\\ = AE[(X-\mu_X)(X-\mu_X)^T]A^T
\\ = ADA^T
\\ = U(\Lambda D)U^T
$$

​	由此可见，$\Sigma_Y$的特征向量为$X$样本的变换轴，变化的倍数为$\sqrt{\lambda_i}$, 即从$\sigma_i $变为, $\sqrt{\lambda_i \sigma_i}​$。


2. 多元正态分布中的协方差矩阵

* 在多元正态分布中
  $$
  P(Y) \propto exp(Y^T\Sigma_Y^{-1}Y)
  \\ = exp(Y^T(U\Lambda^{\frac{1}{2}^{-T}})U\Lambda^{\frac{1}{2}^{-1}}Y)
  \\ = exp((U\Lambda^{\frac{1}{2}^{-1}}Y)^TU\Lambda^{\frac{1}{2}^{-1}}Y)
  \\ = exp(X^TX)
  $$

  

  由此可以得知，一般的多元正态分布是将$Y$变换到$X$不相关的标准多元正态分布





